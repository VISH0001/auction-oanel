<!DOCTYPE html>
<html>
<head>
    <title>Player Lookup</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial; padding: 20px; }
        input { padding: 8px; width: 80px; }
        button { padding: 8px 14px; }
        .info { margin-top: 20px; }
    </style>
</head>
<body>

    <h2>Enter SR Number</h2>
    <input id="sr" type="number" placeholder="1">
    <button onclick="loadPlayer()">Load</button>

    <div class="info">
        <p><strong>Name:</strong> <span id="playerName"></span></p>
        <p><strong>Role:</strong> <span id="playerRole"></span></p>
        <p><strong>Extras:</strong> <span id="playerExtra"></span></p>
        <p><strong>Unavailability:</strong> <span id="playerUnavail"></span></p>
    </div>

    <script>
        let photoTab = null;

        function getDriveViewLink(url) {
            if (!url) return "";

            const match = url.match(/[-\w]{25,}/);
            if (!match) return "";

            return "https://drive.google.com/file/d/" + match[0] + "/view";
        }

        function loadPlayer() {
            const index = parseInt(document.getElementById("sr").value);

            const url = "https://docs.google.com/spreadsheets/d/1pYjX6toLZ78DxHtcCgDLv7EXAMPLE/gviz/tq?tqx=out:json";

            fetch(url)
                .then(r => r.text())
                .then(txt => {
                    const json = JSON.parse(txt.substring(47, txt.length - 2));
                    const rows = json.table.rows;

                    // SR=1 â†’ rows[0]
                    const dataRows = rows;

                    if (!index || index < 1 || index > dataRows.length) {
                        alert("Invalid SR number");
                        return;
                    }

                    const d = dataRows[index - 1].c || [];

                    document.getElementById("playerName").textContent = d[0]?.v || "";
                    document.getElementById("playerRole").textContent = d[1]?.v || "";
                    document.getElementById("playerExtra").textContent =
                        `${d[3]?.v || ""}${d[4]?.v ? ", " + d[4].v : ""}`;
                    document.getElementById("playerUnavail").textContent =
                        `Unavailability - ${d[5]?.v || ""}`;

                    const link = getDriveViewLink(d[2]?.v);
                    if (link) {
                        if (!photoTab || photoTab.closed) {
                            photoTab = window.open(link, "_blank");
                        } else {
                            try { photoTab.location.href = link; }
                            catch(e) { photoTab = window.open(link, "_blank"); }
                        }
                    }
                })
                .catch(err => console.error("Fetch failed:", err));
        }
    </script>

</body>
</html>
