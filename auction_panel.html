<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Live Bidding Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>

:root{
  --neon:#00eaff;
  --neon2:#9ffcff;
  --dark:#03121f;
}

/* TEAM COLORS */
.teamBox{
  max-width:340px;
  margin:8px auto;
  padding:14px;
  border-radius:12px;
  color:white;
  font-size:20px;
  font-weight:700;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border:1px solid rgba(255,255,255,0.08);
  box-shadow:0 0 12px rgba(255,255,255,0.15);
}

/* Glow animation */
@keyframes glowPulse {
  0% { box-shadow:0 0 8px var(--glowColor); }
  50% { box-shadow:0 0 18px var(--glowColor); }
  100% { box-shadow:0 0 8px var(--glowColor); }
}

body{
  margin:0;
  background:#00101a;
  font-family:Arial;
  color:white;
  -webkit-font-smoothing:antialiased;
}

.top-panel{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
  padding:16px;
}

.control-box{
  padding:10px;
  border-radius:10px;
  background:#002332;
  border:1px solid rgba(0,240,255,0.15);
}
.control-box label{
  color:#9ffcff;
  font-size:13px;
}
.control-box input{
  width:110px;
  padding:6px;
  border-radius:6px;
  background:#001621;
  border:1px solid rgba(0,240,255,0.15);
  color:#00eaff;
}

.button{
  padding:10px 14px;
  border-radius:8px;
  border:0;
  background:#00eaff;
  color:#00121a;
  font-weight:700;
  cursor:pointer;
}

.display{
  margin:20px auto;
  width:340px;
  padding:20px;
  border-radius:14px;
  text-align:center;
  font-size:30px;
  color:white;
  font-weight:700;
  border:1px solid rgba(255,255,255,0.1);
}

.big-bid{
  font-size:60px;
  font-weight:900;
  margin-top:5px;
}

.team-label{
  margin-top:8px;
  font-size:26px;
}

.team-grid{
  width:340px;
  margin:20px auto;
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
}

.team-cell{
  padding:12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.1);
  display:flex;
  flex-direction:column;
  align-items:center;
}

.team-cell input{
  width:100%;
  text-align:center;
  padding:8px;
  border-radius:6px;
  background:rgba(0,0,0,0.2);
  border:1px solid rgba(255,255,255,0.15);
  color:white;
  font-weight:700;
}

.team-max{
  margin-top:8px;
  font-size:14px;
  color:white;
}

.rejection{
  margin-top:10px;
  color:#ff8e8e;
  font-weight:700;
}

</style>
</head>

<body>

<script>
/* TEAM COLORS EXACTLY SAME AS LAST10 */
const teamColors = {
  1:{ bg:"#0b4d6b", glow:"#11b2ff" },
  2:{ bg:"#5b1b1b", glow:"#ff4747" },
  3:{ bg:"#8a5c00", glow:"#ffbe33" },
  4:{ bg:"#3e1364", glow:"#b46dff" },
  5:{ bg:"#7c2e00", glow:"#ff7a33" },
  6:{ bg:"#00416a", glow:"#40aaff" },
  7:{ bg:"#6b0041", glow:"#ff2ebd" },
  8:{ bg:"#7a4b00", glow:"#ffc233" }
};
</script>

<!-- TOP CONTROLS -->
<div class="top-panel">
  <div class="control-box">
    <label>Starting Bid</label>
    <input id="startBid" type="number" value="100">
  </div>
  <div class="control-box">
    <label>Fallback Inc</label>
    <input id="fallbackInc" type="number" value="10">
  </div>

  <button class="button" onclick="undoBid()">Undo</button>
  <button class="button" onclick="playerSold()">Player Sold</button>
  <button class="button" onclick="resetBid()">Reset</button>
  <button class="button" onclick="startAuction()" id="startAuctionBtn">Start Auction</button>
</div>

<!-- DISPLAY -->
<div id="displayBox" class="display">
  <div id="currentBid" class="big-bid">100</div>
  <div id="currentTeam" class="team-label">---</div>
  <div id="rejectionNote" class="rejection"></div>
</div>

<div class="team-grid" id="teamGrid"></div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
/* FIREBASE CONFIG */
const firebaseConfig={
  apiKey:"AIzaSyCX6FYo5gVgCmds7Xf63xF-Xcg6eIutQmk",
  authDomain:"auction-71c28.firebaseapp.com",
  databaseURL:"https://auction-71c28-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"auction-71c28",
  storageBucket:"auction-71c28.firebasestorage.app",
  messagingSenderId:"92883040612",
  appId:"1:92883040612:web:473f540c99efc20e8d2271"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

/* LAST 10 BIDS UPDATE FUNCTION */
function pushLast10(teamNum, amount){
  const teamName = document.getElementById("t"+teamNum).value;

  db.ref("last10bids").once("value").then(snap=>{
    let arr = snap.val() || [];
    arr.unshift({
      teamNum: teamNum,
      team: teamName,
      amount: amount
    });
    if(arr.length>10) arr.length=10;
    db.ref("last10bids").set(arr);
  });
}

/* CLEAR LAST10 ON RESET */
function clearLast10(){
  db.ref("last10bids").set([]);
}

/* BUILD TEAM CELLS */
const tg=document.getElementById("teamGrid");
for(let i=1;i<=8;i++){
  let d=document.createElement("div");
  d.className="team-cell";
  d.style.background=teamColors[i].bg;
  d.style.boxShadow=`0 0 14px ${teamColors[i].glow}`;
  d.innerHTML=
    `<input id="t${i}" placeholder="Team ${i}">
     <div id="t${i}_max" class="team-max">Max: —</div>`;
  tg.appendChild(d);
}

let currentBid = 100;
let fallbackInc = 10;
let increments=[];
let maxBids={};
let history=[];
let lastBidTeam=null;
let saleLocked=false;
let auctionRunning=false;

/* SYNC TEAM NAMES */
db.ref('teams').on('value', snap=>{
  const data=snap.val()||{};
  for(let i=1;i<=8;i++){
    let el=document.getElementById("t"+i);
    if(el && data[i]) el.value=data[i];
  }
});

/* SYNC TEAM NAME EDITS */
tg.addEventListener("input", ()=>{
  const obj={};
  for(let i=1;i<=8;i++){
    obj[i]=document.getElementById("t"+i).value;
  }
  db.ref("teams").set(obj);
});

/* SYNC INCREMENTS */
db.ref("increments").on("value", snap=>{
  increments=snap.val()||[];
});

/* SYNC MAX BIDS */
db.ref("maxBids").on("value", snap=>{
  maxBids=snap.val()||{};
  for(let i=1;i<=8;i++){
    let v=maxBids[i]||"—";
    document.getElementById("t"+i+"_max").innerText="Max: "+v;
  }
});

/* SET CURRENT BID BOX COLOR */
function setCurrentBidColor(teamNum){
  if(!teamNum || !teamColors[teamNum]){
    displayBox.style.background="#001621";
    displayBox.style.boxShadow="0 0 12px rgba(255,255,255,0.15)";
    return;
  }
  displayBox.style.background=teamColors[teamNum].bg;
  displayBox.style.boxShadow=`0 0 18px ${teamColors[teamNum].glow}`;
}

/* GET INC */
function getInc(b){
  for(let r of increments){
    if(b>=r.from && b<=r.to) return r.inc;
  }
  return fallbackInc;
}

/* START AUCTION */
function startAuction(){
  auctionRunning=true;
  saleLocked=false;
  db.ref("auctionState").set("running");
}

/* APPLY SETTINGS */
function applySettings(){
  currentBid=parseInt(startBid.value)||100;
  fallbackInc=parseInt(fallbackInc.value)||10;
  lastBidTeam=null;
  history=[];
  updateDisplay("---");
}

/* UPDATE DISPLAY */
function updateDisplay(t){
  currentTeam.innerText=t;
  currentBidEl.innerText=currentBid;
}

/* PLACE BID */
function placeBid(n){
  if(saleLocked) return;
  if(!auctionRunning) return;
  if(lastBidTeam===n) return;

  const next = (history.length===0 ? currentBid : currentBid+getInc(currentBid));

  if(maxBids[n] && next>maxBids[n]) return;

  const teamName=document.getElementById("t"+n).value;

  pushLast10(n,next);
  setCurrentBidColor(n);

  history.push({bid:currentBid,team:currentTeam.innerText});
  currentBid=next;
  lastBidTeam=n;
  updateDisplay(teamName);
}

/* UNDO */
function undoBid(){
  if(history.length===0) return;
  saleLocked=false;
  history.pop();
  
  db.ref("last10bids").once("value").then(s=>{
    let arr=s.val()||[];
    arr.shift();
    db.ref("last10bids").set(arr);
  });

  let prev=history[history.length-1];
  if(!prev){
    currentBid=parseInt(startBid.value)||100;
    updateDisplay("---");
    setCurrentBidColor(null);
    lastBidTeam=null;
    return;
  }

  currentBid=prev.bid;
  updateDisplay(prev.team);
}

/* RESET */
function resetBid(){
  saleLocked=false;
  auctionRunning=false;
  currentBid=parseInt(startBid.value)||100;
  lastBidTeam=null;
  history=[];
  clearLast10();
  updateDisplay("---");
  setCurrentBidColor(null);
}

/* PLAYER SOLD */
function playerSold(){
  saleLocked=true;
}

/* OWNER BIDS */
db.ref("latestBid").on("value", snap=>{
  const d=snap.val();
  if(!d) return;
  placeBid(d.teamNum);
});

/* KEYBOARD SHORTCUTS */
document.addEventListener("keydown", e=>{
  if(e.key>="1"&&e.key<="8") placeBid(parseInt(e.key));
});

const displayBox=document.getElementById("displayBox");
const currentBidEl=document.getElementById("currentBid");

</script>

</body>
</html>
