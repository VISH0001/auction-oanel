<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Live Bidding Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{
  --neon:#00eaff; --neon2:#9ffcff; --dark:#03121f;
}
body{
  margin:0;
  background:radial-gradient(circle,#06273a,#00101a 70%);
  font-family:Arial,Helvetica,sans-serif;
  color:white;
}

/* Top controls */
.top-panel{
  display:flex;
  gap:14px;
  justify-content:center;
  padding:18px;
  align-items:center;
}
.control-box{
  padding:10px 12px;
  border-radius:10px;
  background:rgba(0,20,35,0.6);
  border:1px solid rgba(0,240,255,0.12);
}
.control-box label{
  color:var(--neon2);
  font-size:13px;
  display:block;
  margin-bottom:6px;
}
.control-box input{
  width:120px;
  padding:6px;
  border-radius:6px;
  border:1px solid rgba(0,240,255,0.12);
  background:#00121c;
  color:var(--neon);
}

/* Buttons */
.button{
  padding:10px 14px;
  border-radius:8px;
  border:0;
  background:var(--neon);
  color:#00131b;
  font-weight:700;
  cursor:pointer;
}

/* Current bid area */
.display{
  margin:18px auto;
  width:420px;
  background:#00111a;
  padding:28px;
  border-radius:14px;
  text-align:center;
  border:1px solid rgba(0,240,255,0.12);
}
.big-bid{
  font-size:72px;
  font-weight:800;
  color:var(--neon);
}
.team-label{
  font-size:30px;
  color:var(--neon2);
  margin-top:6px;
}

/* Team grid */
.team-grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:12px;
  width:88%;
  margin:20px auto;
}
.team-cell{
  background:#001621;
  padding:10px;
  border-radius:10px;
  text-align:center;
  border:1px solid rgba(0,240,255,0.08);
}
.team-cell input{
  width:100%;
  padding:8px;
  background:#00121c;
  border-radius:8px;
  color:var(--neon);
  border:1px solid rgba(0,240,255,0.08);
}

.undo-reset{
  text-align:center;
  padding:12px;
}
.small{
  font-size:12px;
  color:#9ffcff;
}
</style>
</head>

<body>

<!-- TOP CONTROLS -->
<div class="top-panel">
  <div class="control-box">
    <label>Starting Bid</label>
    <input id="startBid" type="number" value="100">
  </div>

  <div class="control-box">
    <label>Increment</label>
    <input id="increment" type="number" value="10">
  </div>

  <button class="button" onclick="applySettings()">Apply</button>
</div>

<!-- DISPLAY AREA -->
<div class="display">
  <div style="font-size:22px; color:#9ffcff; margin-bottom:12px;">CURRENT BID</div>
  <div class="big-bid" id="currentBid">100</div>
  <div class="team-label" id="currentTeam">---</div>
</div>

<div style="width:95%; margin:auto; text-align:center;">
  <div class="small">Edit team names below — updates sync to owners immediately.</div>
</div>

<!-- TEAM NAME EDIT GRID -->
<div class="team-grid" id="teamGrid"></div>

<!-- Undo / Reset -->
<div class="undo-reset">
  <button class="button" onclick="undoBid()">Undo</button>
  <button class="button" onclick="resetBid()">Reset</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCX6FYo5gVgCmds7Xf63xF-Xcg6eIutQmk",
  authDomain: "auction-71c28.firebaseapp.com",
  databaseURL: "https://auction-71c28-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "auction-71c28",
  storageBucket: "auction-71c28.firebasestorage.app",
  messagingSenderId: "92883040612",
  appId: "1:92883040612:web:473f540c99efc20e8d2271"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- SECURE OWNER KEYS ---
const ownerKeys = {
  "t1_92fA6k3Z":1,
  "t2_Qp71xL0S":2,
  "t3_n88RwA1D":3,
  "t4_F92amP0L":4,
  "t5_cH7x9LmQ":5,
  "t6_B1mZ3kPx":6,
  "t7_Ux8q21Nv":7,
  "t8_Yp0mR4Ws":8
};

// default names
const defaultTeams = {
  1:"Team A",2:"Team B",3:"Team C",4:"Team D",
  5:"Team E",6:"Team F",7:"Team G",8:"Team H"
};

// ensure data exists
db.ref("teams").once("value").then(s=>{ if(!s.exists()) db.ref("teams").set(defaultTeams); });
db.ref("ownerKeys").once("value").then(s=>{ if(!s.exists()) db.ref("ownerKeys").set(ownerKeys); });

// Generate team input grid
const grid = document.getElementById("teamGrid");
for(let i=1;i<=8;i++){
  const d=document.createElement("div");
  d.className="team-cell";
  d.innerHTML=`<input id="t${i}" data-team="${i}">`;
  grid.appendChild(d);
}

// Live-sync team names
db.ref("teams").on("value", snap=>{
  const teams=snap.val()||defaultTeams;
  for(let i=1;i<=8;i++){
    document.getElementById("t"+i).value = teams[i];
  }
});

// update team names when edited
let updateTimer;
grid.addEventListener("input", ()=>{
  clearTimeout(updateTimer);
  updateTimer=setTimeout(()=>{
    const upd={};
    for(let i=1;i<=8;i++){
      upd[i] = document.getElementById("t"+i).value || ("Team "+i);
    }
    db.ref("teams").set(upd);
  },400);
});

// ---------- BID LOGIC ----------
let currentBid = parseInt(document.getElementById("startBid").value) || 100;
let increment = parseInt(document.getElementById("increment").value) || 10;
let history=[];
let lastBidTeam = null;

// Push updates to owners
function updateOwners(){
  db.ref("liveDisplay").set({
    currentBid: currentBid,
    currentTeam: document.getElementById("currentTeam").innerText,
    ts: Date.now()
  });
}

// apply admin settings
function applySettings(){
  currentBid = parseInt(startBid.value)||100;
  increment = parseInt(increment.value)||10;
  history=[];
  lastBidTeam=null;
  updateDisplay("---");
  updateOwners();
}

// UI update
function updateDisplay(team){
  document.getElementById("currentBid").innerText=currentBid;
  document.getElementById("currentTeam").innerText=team;
}

// place bid
function placeBid(teamNum){
  // prevent same team bidding twice
  if(lastBidTeam === teamNum){
    console.log("Ignored repeated bid by team", teamNum);
    return;
  }

  lastBidTeam = teamNum;

  history.push({
    bid: currentBid,
    team: document.getElementById("currentTeam").innerText
  });

  currentBid += increment;
  const teamName = document.getElementById("t"+teamNum).value || ("Team "+teamNum);
  updateDisplay(teamName);
  updateOwners();
}

// Undo
function undoBid(){
  if(history.length===0) return;
  const last = history.pop();
  currentBid = last.bid;
  lastBidTeam = null;
  updateDisplay(last.team);
  updateOwners();
}

// Reset
function resetBid(){
  currentBid = parseInt(document.getElementById("startBid").value)||100;
  lastBidTeam = null;
  history=[];
  updateDisplay("---");
  updateOwners();
}

// Keyboard admin bidding: press 1–8
document.addEventListener("keydown", e=>{
  if(e.key >= "1" && e.key <= "8"){
    placeBid(Number(e.key));
  }
});

// Owner-triggered bids
let lastSeenTime = 0;
db.ref("latestBid").on("value", snap=>{
  const d=snap.val();
  if(!d || !d.time) return;
  if(d.time <= lastSeenTime) return;
  lastSeenTime = d.time;
  placeBid(d.teamNum);
});

// initial
window.onload = ()=>{
  updateOwners();
};

</script>
</body>
</html>
