<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Owner Bid Button</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#00121c;
  --panel:#001822;
  --text-white:#ffffff;
}

/* Basic layout */
html,body{ height:100%; margin:0; background:var(--bg); font-family:Arial,Helvetica,sans-serif; color:var(--text-white); }
.wrap{ display:flex; flex-direction:column; height:100vh; overflow:hidden; }

/* BIG TEAM BUTTON */
#bigButtonArea{
  height:70%;
  display:flex;
  justify-content:center;
  align-items:center;
}

#bidBtn{
  width:70vw;
  height:70vw;
  max-width:70vh;
  max-height:70vh;
  border-radius:50%;
  border:none;
  font-size:40px;
  font-weight:bold;
  color:white;
  cursor:pointer;
  transition:transform 0.12s ease;
}

#bidBtn:active{ transform:scale(0.96); }

/* INFO PANEL */
#infoPanel{
  height:30%;
  background:var(--panel);
  padding:16px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
  align-items:center;
  border-top:2px solid rgba(0,64,96,0.6);
}

.label{ font-size:14px; opacity:0.8; }
.value{ font-size:20px; font-weight:700; }
.bigvalue{ font-size:28px; font-weight:800; }
.maxbox{ color:#9ffcff; font-weight:700; font-size:18px; }

.full{ grid-column:1 / -1; text-align:center; }
#rejectionMsg{ color:#ff8787; font-weight:800; font-size:16px; }

/* Dynamic glow animation */
@keyframes glowPulse {
  0% { box-shadow:0 0 10px var(--pulseColor1); }
  50%{ box-shadow:0 0 34px var(--pulseColor2); }
  100%{ box-shadow:0 0 10px var(--pulseColor1); }
}
</style>
</head>

<body>

<div class="wrap">

  <div id="bigButtonArea">
    <button id="bidBtn">BID</button>
  </div>

  <div id="infoPanel">
    <div class="label">Your Team</div><div id="ownerTeam" class="value">—</div>
    <div class="label">Current Highest Bid</div><div id="currentBid" class="bigvalue">—</div>
    <div class="label">Highest Bidding Team</div><div id="currentTeam" class="value">—</div>
    <div class="label">Your Max Bid</div><div id="myMax" class="maxbox">—</div>
    <div class="label">(Secure Key)</div><div id="keyText" class="value">—</div>
    <div id="error" class="full"></div>
    <div id="rejectionMsg" class="full"></div>
  </div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
/* SAME COLORS AS PANEL + LAST10 */
const TEAM_COLORS = {
  1: { bg:"#01579b", glow:"#11b2ff" },
  2: { bg:"#c62828", glow:"#ff4747" },
  3: { bg:"#4e342e", glow:"#ffbe33" },
  4: { bg:"#4527a0", glow:"#b46dff" },
  5: { bg:"#2e7d32", glow:"#5aff63" },
  6: { bg:"#283593", glow:"#40aaff" },
  7: { bg:"#ad1457", glow:"#ff2ebd" },
  8: { bg:"#ff8f00", glow:"#ffc233" }
};

const firebaseConfig = {
    apiKey: "AIzaSyCX6FYo5gVgCmds7Xf63xF-Xcg6eIutQmk",
    authDomain: "auction-71c28.firebaseapp.com",
    databaseURL: "https://auction-71c28-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "auction-71c28",
    storageBucket: "auction-71c28.firebasestorage.app",
    messagingSenderId: "92883040612",
    appId: "1:92883040612:web:473f540c99efc20e8d2271"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function el(id){ return document.getElementById(id); }
function showError(msg){ el('error').innerText = msg || ''; }

const params = new URLSearchParams(window.location.search);
const key = params.get('key');
el('keyText').innerText = key || 'none';

let myTeam = null;

function lock(){
  el('bidBtn').disabled = true;
  el('bidBtn').style.opacity = 0.45;
}

/* validate key */
db.ref('ownerKeys/' + key).once('value').then(snap=>{
  const t = snap.val();
  if(!t){ showError('Invalid key. Contact admin.'); lock(); return; }
  myTeam = t;
  applyTeamColor(myTeam);
  initFor(myTeam);
});

/* Apply owner color to UI */
function applyTeamColor(teamNum){
  const c = TEAM_COLORS[teamNum];

  // button color
  el('bidBtn').style.background = c.bg;

  // glowing animation — dynamic CSS vars
  document.documentElement.style.setProperty('--pulseColor1', c.glow+"33");
  document.documentElement.style.setProperty('--pulseColor2', c.glow);

  el('bidBtn').style.animation = "glowPulse 1.8s ease-in-out infinite";
}

function initFor(teamNum){

  /* show team name live */
  db.ref('teams/' + teamNum).on('value', snap=>{
    el('ownerTeam').innerText = snap.val() || ('Team '+teamNum);
  });

  /* show owner's max */
  db.ref('maxBids/' + teamNum).on('value', snap=>{
    const v = snap.val();
    el('myMax').innerText = (v === 0 || v === null || v === undefined) ? '—' : v;
  });

  /* live auction updates */
  db.ref('liveDisplay').on('value', snap=>{
    const d = snap.val();
    if(!d) return;

    el('currentBid').innerText = d.currentBid ?? '—';
    el('currentTeam').innerText = d.currentTeam ?? '—';

    if(d.currentTeam === el('ownerTeam').innerText){
      lock();
    } else {
      el('bidBtn').disabled = false;
      el('bidBtn').style.opacity = 1;
    }
  });

  /* listen max rejections */
  db.ref('rejections/' + teamNum).on('value', snap=>{
    const r = snap.val();
    if(!r){ el('rejectionMsg').innerText = ''; return; }
    el('rejectionMsg').innerText = `Bid rejected — max allowed ${r.max}. Attempted: ${r.attempted}`;
    setTimeout(()=> db.ref('rejections/' + teamNum).remove(), 7000);
  });

  /* tap to bid */
  el('bidBtn').onclick = ()=>{
    db.ref('latestBid').set({
      teamNum: teamNum,
      time: Date.now()
    });
  };
}
</script>
</body>
</html>
